BizQQWPA.define("wpa.ViewHelper","util.getJSONP,util.report,util.proxy,util.onLoad,util.className,util.events,util.Style,util.titleFlash",function(require){var getJSONP=require("getJSONP"),report=require("report"),proxy=require("proxy"),onLoad=require("onLoad"),className=require("className"),events=require("events"),Style=require("Style"),titleFlash=require("titleFlash");var ViewHelper=function(context,wpa){this.doc=context;this.wpa=wpa;this.params=wpa.params};ViewHelper.prototype={getJSONP:getJSONP,report:report,proxy:proxy,onLoad:onLoad,titleFlash:titleFlash,setTimingRpt:function(f1,f2,f3_ie,f3_c){var _t,_p=window.performance||window.webkitPerformance||window.msPerformance,_ta=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],_da=[],_t0,_tmp,f3=f3_ie;if(_p&&(_t=_p.timing)){if(typeof _t.msFirstPaint!="undefined"){_ta.push("msFirstPaint")}else{if(f3_c){f3=f3_c}}_t0=_t[_ta[0]];for(var i=1,l=_ta.length;i<l;i++){_tmp=_t[_ta[i]];_tmp=_tmp?_tmp-_t0:0;if(_tmp>0){_da.push(i+"="+_tmp)}}if(window.d0){_da.push("30="+(window.d0-_t0))}var url="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1="+f1+"&flag2="+f2+"&flag3="+f3+"&"+_da.join("&");this.report(url)}},getOnlineStatus:function(){var helper=this,params=this.params;var appointList=params.a;if(!appointList||appointList+""==="0"){return}var url="http://crm2.qq.com/cgi/portalcgi/get_kf_status.php",opts={kfuin:params.kfuin,aty:params.aty,al:appointList};getJSONP(url,opts,function(rs){var isOffline=rs.r===0&&rs.data.list[appointList]!==1;isOffline&&helper.setOffline()})},setOffline:function(){this.addClass(this.doc.body,"offline")},addClass:className.addClass,hasClass:className.hasClass,removeClass:className.removeClass,addStyle:Style.add,addEvent:events.addEvent,xssFilter:function(str){if(!str){return""}return str.replace(/</g,"&lt;").replace(/>/,"&gt;").replace(/'/g,"&acute;").replace(/"/,"&quot;")},chat:function(){this.wpa.launchChat()},anonymousChat:function(){this.wpa.launchAnonymousChat()},remove:function(){this.wpa.remove()}};return ViewHelper});