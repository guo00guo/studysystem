<!DOCTYPE html>
<head>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

    <title>学习者中心</title>
    <link rel="stylesheet" href="member/css/global.css"/>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="member/css/global.css"/>
    <link type="text/css" rel="stylesheet" href="css/layer.css" id="skinlayercss"/>
    <link href="member/css/style.css" type="text/css" rel="stylesheet"/>
    <script src="js/jquery-1.9.1.min.js"></script>
</head>

<body>
<div class="container-fluid company_top">
    <div class="center-block w_1200 center-block">
        <div class="logo">
            <span style="padding-top:8px;color: white; font-size: 28px;float: left;cursor: pointer;">个性化学习系统</span>
        </div>
        <div class="member_name">
            <dl class="member_con" id="m_info">
                <a>
                    <dt>
                        <img src="images/touxiang.jpg" class="imageUrl"/>
                    </dt>
                    <dd>
                        <strong class="userName"></strong>
                        <strong class="realName"></strong>
                    </dd>
                </a>
            </dl>
        </div>
        <div class="top_nav">
            <dl>
                <dd>
                    <a href="index.html">首页</a>
                </dd>
                <dd>
                    <a href="course.html">课程分类</a>
                </dd>
                <dd>
                    <a href="day.html">每日一课</a>
                </dd>
                <dd>
                    <a href="recommend.html">推荐课程</a>
                </dd>
            </dl>
        </div>
    </div>
</div>

<!-- 内容 -->

<div class="main">
    <div class="mtcon">
        <!-- 左边导航 -->
        <div class="leftbox">
            <ul class="l_list">
                <li>
                    <!-- 标题 -->
                    <p data-attr="" data-val="1" class="m_title">
								<span> 
									<img src="images/r_1.jpg"/>
								</span>
                        <strong>
                            <img src="images/l_2.png"/>
                        </strong>
                        <a href="javascript:">个人中心</a>
                    </p>
                    <ul>
                        <li id="q_text_1">
                            <div class="q_text">
                                <p>
                                    <a id="right_one" class="m_option">账户信息</a>
                                </p>
                                <p>
                                    <a id="right_two" class="m_option">修改资料</a>
                                </p>
                                <p>
                                    <a id="right_three" class="m_option">修改密码</a>
                                </p>
                            </div>
                        </li>
                    </ul>
                </li>
                <li>
                    <!-- 我的学习 -->
                    <p data-val="2" class="m_title">
                        <span> <img src="images/r_1.jpg"/></span>
                        <strong> <img src="images/l_4.png"/></strong>
                        <a href="javascript:">我的学习</a>
                    </p>
                    <ul>
                        <li id="q_text_2">
                            <div class="q_text">
                                <p>
                                    <a id="right_four" class="m_option">我的课程</a>
                                </p>
                                <p>
                                    <a id="right_five" class="m_option">学习记录</a>
                                </p>
                            </div>
                        </li>
                    </ul>
                </li>

                <li>
                    <!-- 账号管理 -->
                    <ul>
                        <li id="q_text_6">
                            <div class="q_text">
                                <p>
                                    <a class="m_option" onclick="userLogout()">退出登录</a>
                                </p>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>

        </div>

        <!-- 右边导航  index  -->
        <div id="right_one" class="rightbox">
            <!-- 账号信息 -->
            <p class="r_title">账号信息</p>
            <!-- 信息 -->
            <div class="ind_box">
                <!-- 个人中心 -->
                <div class="inx_box">
                    <ul class="olist">
                        <li class="li_o">
                            <div class="img_v">
                                <img width="82" height="82" src="" class="imageUrl"/>
                            </div>
                            <div class="text_v">
                                <p><b class="realName"></b></p>
                                <p><strong></strong> 您好！</p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="hr10"></div>
            </div>
            <div class="hr20"></div>
        </div>

        <!-- 右边导航  info  -->
        <div id="right_two" class="rightbox hidden">
            <!-- 账号信息 -->
            <p class="r_title">修改资料</p>
            <!-- 信息 -->
            <div class="per_box">
                <form autocomplete="off" method="post" id="form_UserInfo" class="nice-validator n-default"
                      novalidate="novalidate">
                    <table class="up_table">
                        <tbody>
                        <tr valign="top">
                            <td headers="" rowspan="" colspan="2">
                                <div class="upload_right">
                                    <img width="120" height="120" style="width:120px; height:120px;"
                                         src="" id="imgUserFace" class="imageUrl"/>
                                </div>
                            </td>
                        </tr>

                        <div>
                            <input type="file" style="cursor:pointer;" onchange="changepic(this)" value="上传头像" id="imageUrl"/>
                        </div>

                        <tr>
                            <td headers="" rowspan="" colspan="">登录ID</td>
                            <td headers="" rowspan="" colspan="" class="userName">000001</td>
                        </tr>
                        <tr>
                            <td headers="" rowspan="" colspan="">姓名</td>
                            <td headers="" rowspan="" colspan="" id="realName">大枣1234</td>
                        </tr>
                        <tr>
                            <td headers="" rowspan="" colspan="">性别</td>
                            <td headers="" rowspan="" colspan="">
                                <input type="radio" value="0" name="sex" class="rad" checked="checked"/>保密&nbsp;&nbsp;
                                <input type="radio" value="男" name="sex" class="rad"/>男&nbsp;&nbsp;
                                <input type="radio" value="女" name="sex" class="rad"/>女
                            </td>
                        </tr>

                        <tr>
                            <td headers="" rowspan="" colspan="">地址</td>
                            <td headers="" rowspan="" colspan="">
                                <input type="text" data-ok="" data-tip="请输入您的地址" value="" name="address" id="address"/>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <p style=" float:none; padding:0px; padding-bottom:30px; padding-top:15px; padding-left:110px; clear:both;">
                        <input value="提交" style="cursor:pointer; width:84px; height:41px; border:solid dodgerblue 2px;"
                               type="button" id="btnSubmit">
                    </p>
                </form>
            </div>
        </div>

        <!-- 右边导航  pwd  -->
        <div id="right_three" class="rightbox hidden">
            <!-- 账号信息 -->
            <p class="r_title">修改密码</p>
            <!-- 信息 -->
            <div class="per_box">
                <div class="p_box">
                    <form autocomplete="off" method="post" id="form_PWD" class="nice-validator n-default"
                          novalidate="novalidate">
                        <table>
                            <tbody>
                            <tr>
                                <td>请输入旧密码</td>
                                <td>&nbsp;&nbsp;
                                    <input type="password" value="" maxlength="16" name="oldPwd" id="text_pwd"
                                           />
                                </td>
                            </tr>
                            <tr>
                                <td>请输入新密码</td>
                                <td>&nbsp;&nbsp;
                                    <input required="true" type="password" value="" maxlength="16" name="newPwd" id="text_pwd1"
                                           />
                                </td>
                            </tr>
                            <tr>
                                <td>确认密码</td>
                                <td>&nbsp;&nbsp;
                                    <input required="true" type="password" value="" maxlength="16" name="newPwd2" id="text_pwd2"
                                           />
                                </td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;&nbsp;
                                    <input required="true" type="button" value="确认" style="width: 87px; height: 41px;" class="EmailBtn"
                                           data-value="2" id="log_2"/></td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
        </div>

        <!-- 右边导航 collect -->
        <div id="right_four" class="rightbox hidden">
            <p class="r_title">我的课程</p>
            <!-- 信息 -->
            <div class="collect"> </div>
        </div>

        <!-- 右边导航play_record -->
        <div id="right_five" class="rightbox hidden">
            <p class="r_title">学习记录</p>
            <!-- 信息 -->
            <div class="tv_box">
                <p class="tv_p"><span>您学习&nbsp;<em>1</em>&nbsp;个课程</span></p>
                <a href="course_detail.html" style="cursor: pointer;" data-title="java编程思想" data-id="1420">
                    <ul class="tvlist">
                        <li>
                            <img style="width:89px;height:70px;" src="images/java.jpg" class="s_img"/>
                            <p>
                                <span class="tit">java编程思想</span>
                            </p>
                            <p class="bse">
                                <span class="tit">最后学习时间：2016-1-24</span>
                                <span class="the"></span> <span class="bor">
											</span>
                            </p>
                        </li>
                    </ul>
                </a>
                <a href="course_detail.html" style="cursor: pointer;" data-title="java编程思想" data-id="1420">
                    <ul class="tvlist">
                        <li>
                            <img style="width:89px;height:70px;" src="images/java.jpg" class="s_img"/>
                            <p>
                                <span class="tit">java编程思想</span>
                            </p>
                            <p class="bse">
                                <span class="tit">最后学习时间：2016-1-24</span>
                                <span class="the"></span> <span class="bor">
											</span>
                            </p>
                        </li>
                    </ul>
                </a>
                <a href="course_detail.html" style="cursor: pointer;" data-title="java编程思想" data-id="1420">
                    <ul class="tvlist">
                        <li>
                            <img style="width:89px;height:70px;" src="images/java.jpg" class="s_img"/>
                            <p>
                                <span class="tit">java编程思想</span>
                            </p>
                            <p class="bse">
                                <span class="tit">最后学习时间：2016-1-24</span>
                                <span class="the"></span> <span class="bor">
											</span>
                            </p>
                        </li>
                    </ul>
                </a>
            </div>
            <div class="hr10"></div>
            <!-- 分页 -->
            <div style="clear: both; text-align: right;" class="fybox">
            </div>
            <div class="hr20"></div>
        </div>

    </div>

    <script>
        $(function loadInfo() {
            if (!window.sessionStorage) {
                alert("浏览器不支持sessionStorage");
            }
            else {
                var storage = window.sessionStorage;
                var userdata = JSON.parse(storage["userdata"]);

                if ($.isEmptyObject(userdata)) {
                    console.log("数据为空");
                }
                else {
                    $(".userName").text(userdata.userName);
                    $(".realName").text(userdata.realName);
                    $(".imageUrl").attr("src", userdata.imageUrl);
                    $("#realName").text(userdata.realName);
                    $("#address").val(userdata.address);
                    $("span.student_name").html(userdata.userName);
                }
            }

            //修改信息
            $("#btnSubmit").click(function () {
                var data = userdata;
                data.address = $("#address").val();
                data.gender = $("input[name=sex]:checked").val();
                var fd = new FormData();
                fd.append('userId', data.userId);
                fd.append('realName', data.realName);
                fd.append('address', data.address);
                fd.append('gender', data.gender);
                fd.append('file', $("#imageUrl")[0].files[0]);
                console.log(fd);

                $.ajax({
                    type: 'post',
                    url: 'student/updateStudentById',
                    data: fd,
                    contentType: false,
                    processData: false,
                    enctype: 'multipart/form-data',
                    success: function (data) {
                        console.log(data);

                        if (data.code == 1) {
                            if (!window.sessionStorage) {
                                alert("浏览器不支持sessionStorage");
                            }
                            else {
                                alert("修改信息成功！");
                                var storage = window.sessionStorage;
                                storage.clear();
                                storage.setItem("userdata", JSON.stringify(data.data));
                                console.log(storage["userdata"]);

                                window.location.reload();
                            }
                        }
                        else if(data.code == -1){
                            alert("修改失败！");
                        }
                        else{
                            var storage = window.sessionStorage;
                            storage.clear();

                            alert("请登录！");
                            window.location.href = "index.html";
                        }
                    }
                });
            });

            //修改密码
            $("#log_2").click(function () {
                var oldPassword = $("#text_pwd").val();
                var newPassword = $("#text_pwd1").val();
                var twoPassword = $("#text_pwd2").val();

                if (newPassword != twoPassword) {
                    alert('两次密码不一样');
                    return;
                }
                var data = {userId: userdata.userId, oldPassword: oldPassword, newPassword: newPassword};

                $.ajax({
                    type: 'post',
                    url: 'student/changeStudentPassWord',
                    data: data,
                    success: function (data) {
                        console.log(data)
                        if (data.code == 1) {//成功！
                            alert(data.codeMsg);

                            window.location.reload();
                        }
                        else if(data.code == -10){
                            alert(data.codeMsg);
                        }
                        else{
                            var storage = window.sessionStorage;
                            storage.clear();

                            alert("请登录！");
                            window.location.href = "index.html";
                        }
                    }
                });
            });

            //获取我的课程信息
            $("#right_four").click(function (){
                $.ajax({
                    type: 'post',
                    url: 'student/getAllSelectCourseByUserId',
                    data: {
                        userId: userdata.userId
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.length);
                        $(".collect").children().remove();

                        if(data.length == 0){
                            $(".collect").append("<h4>暂无课程信息！</h4>");
                        }
                        else if(data.length > 0 && data.length < 100){
                            for(var i = 0; i < data.length; i++){
                                $(".collect").append(
                                    "<a target='_blank' href='course_detail.html?courseId="+ data[i].courseList[0].courseId +"' style='cursor: pointer;'>" +
                                    "<ul id='ulList' class='c_bottom'><li></li> <li class='b_li'>" +
                                    "<p><img src='"+ data[i].courseList[0].imageUrl +"' style='width:217px;height:181px;' alt=''/></p>" +
                                    "<p>"+ data[i].courseList[0].courseName +"</p>"+
                                    "</li> </ul> </a>"
                                );
                            }
                        }
                        else {
                            var storage = window.sessionStorage;
                            storage.clear();

                            alert("请登录！");
                            window.location.href = "index.html";
                        }
                    }
                });
            });
        });

        $(".m_title").click(function () {
            var id = $(this).attr("data-val");
            var str = $(this).attr("data-attr");
            if (str == "open") {
                $("#q_text_" + id).slideDown(300);
                $(this).attr("data-attr", "");
            } else {
                $("#q_text_" + id).slideUp(300);
                $(this).attr("data-attr", "open");
            }
        });

        $("a.m_option").click(function () {
            var op = $(".ph");
            op.removeClass("ph");
            $(this).addClass("ph");
            var nothidden = $("div.rightbox");
            nothidden.addClass("hidden");
            var m_option_id = $(this).attr("id");
            $("div#" + m_option_id).removeClass("hidden");
        });

        $("a.m_option").css("cursor", "pointer");

        function userLogout() {
            $.ajax({
                type: 'post',
                url: 'user/logout',
                success: function () {
                    if (!window.sessionStorage) {
                        alert("浏览器不支持sessionStorage");
                        return false;
                    } else {
                        var storage = window.sessionStorage;
                        alert("退出成功");
                        storage.clear();

                        window.location.href = 'index.html';
                    }
                }
            });
        }

        function changepic(obj) {
            //console.log(obj.files[0]);//这里可以获取上传文件的name
            var newsrc = getObjectURL(obj.files[0]);
            document.getElementById('imgUserFace').src = newsrc;
        }

        //建立一個可存取到該file的url
        function getObjectURL(file) {
            var url = null ;
            // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已
            if (window.createObjectURL!=undefined) { // basic
                url = window.createObjectURL(file) ;
            } else if (window.URL!=undefined) { // mozilla(firefox)
                url = window.URL.createObjectURL(file) ;
            } else if (window.webkitURL!=undefined) { // webkit or chrome
                url = window.webkitURL.createObjectURL(file) ;
            }
            return url ;
        }

    </script>

</div>
<!--底部footer-->
<div class="clear"></div>
</body>

</html>