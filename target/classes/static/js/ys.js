(function(){var o=onyx.Cookie,p=onyx.Window,i=onyx.util.TypeUtil,l=onyx.util.StrUtil,u=onyx.util.ObjUtil,v=onyx.util.ArrayUtil,w=onyx.util.EventUtil,m=onyx.util.DomUtil;__package("ys").__class("ShoppingCart").__static(function(){function q(a,e){a=a.config();for(var d={},b=0,c=e.length;b<c;b++){var f=e[b];for(var g in f){var h=d[g];if(!h){h=[];d[g]=h}h[b]=f[g]}}e=true;b="";for(g in d){if(e)e=false;else b+="&";b=b+g+"="+d[g].join(",")}o.set(a.cookieKey,b,{expires:a.expires,domain:a.domain,path:"/"})}
function x(a){a=a.config();a=o.get(a.cookieKey);if(l.isEmpty(a))return[];a=a.split("&");for(var e=[],d={},b=0,c=0,f=a.length;c<f;c++){var g=a[c];if(!l.isEmpty(g)){g=g.split("=");if(g.length===2){var h=g[1].split(",");b=Math.max(b,h.length);d[g[0]]=h}}}for(c=0;c<b;c++){f={};for(var r in d){a=d[r];arrLen=a.length;f[r]=c>arrLen-1?null:a[c]}e.push(f)}return e}function y(a){for(var e=m.byTag("a"),d="/e/ShopSys/doaction.php?enews=AddBuycar".toLowerCase(),b="/cart/cart1/".toLowerCase(),c=0,f=e.length;c<
f;c++){var g=e[c],h;try{h=m.attr(g,"href")}catch(r){continue}if(h){h=h.toLowerCase();var k=0;if(h.indexOf(d)>=0)k=1;else if(h.indexOf(b)>=0)k=2;if(k>0){j=j.replace("%SOURCE%",k);z(a,g,k)}}}}function z(a,e,d){var b=m.attr(e,"href");m.attrs(e,{href:"javascript:;",target:""});var c,f;if(d==1){d=b.indexOf("?");if(d<0)return false;b=b.substring(d+1);b=A(b);classId=b.classid;c=b.id;f=B(classId)}else if(d==2){b=b.split("/");if(b.length==0)return false;b=b[b.length-1];d=b.indexOf(".");if(d<=0)return false;
b=b.substring(0,d);b=b.split("-");d=b[0];c=b[1];f=C(d)}if(!c||!f)return false;w.click(e,function(){a.add({itemId:c,type:f})})}function A(a){var e={};a=a.split("&");for(var d=0,b=a.length;d<b;d++){var c=a[d].split("=");if(!(c.length<2)){var f=c[0];if(f.length!=0)e[f]=c[1]}}return e}function B(a){a=parseInt(a);switch(a){case 135:return"B";case 134:return"C";case 10011:return"D";default:return"A"}}function C(a){switch(a){case "package":return"B";case "timelimit":return"C";case "vip":return"D";case "course":return"A";
default:return"A"}}var s=p.url().host(),n=s.split("."),t=s=="localhost"?"localhost":"."+n[n.length-2]+"."+n[n.length-1],j="http://order"+t+"/Order?source=%SOURCE%";return{__init:function(){this.__config={cookieKey:"shopping_cart",domain:t,expires:2592E6};var a=this;$(document).ready(function(){y(a)})},config:function(a){if(i.isObj(a))this.__config=u.merge(this.__config,a);else return this.__config},getByItemId:function(a){for(var e=this.items(),d=0,b=e.length;d<b;d++){var c=e[d];if(c.itemId==a)return c}return null},
add:function(a,e){a=a||{};var d=a.itemId,b=a.type,c=a.num;if(i.isUndef(d))throw new Error("\u53c2\u6570itemId\u4e0d\u80fd\u4e3a\u7a7a");if(!i.isStr(b)||l.isEmpty(b))throw new Error("\u53c2\u6570type\u9519\u8bef");c=parseInt(c);if(!c||isNaN(c)||c<=0)c=1;i.isBool(e)||(e=true);b=this.items();for(var f=false,g=0,h=b.length;g<h;g++)if(b[g].itemId==d){f=true;break}if(!f){a.num=c;b.push(a)}q(this,b);e&&j&&p.url(j)},update:function(a,e){a=a||{};var d=this.items(),b=a.itemId,c=a.type,f=a.num;if(i.isUndef(b))throw new Error("\u53c2\u6570itemId\u4e0d\u80fd\u4e3a\u7a7a");
if(!i.isStr(c)||l.isEmpty(c))throw new Error("\u53c2\u6570type\u9519\u8bef");f=parseInt(f);!f||isNaN(f);c=false;f=0;for(var g=d.length;f<g;f++)if(d[f].itemId==b){d[f]=a;c=true;break}if(!c)return false;q(this,d);e&&j&&p.url(j)},remove:function(a){var e=this.items();v.remove(e,a);q(this,e)},items:function(){return x(this)},clear:function(){var a=this.config();o.remove(a.cookieKey)}}}())})();
